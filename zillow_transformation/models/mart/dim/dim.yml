version: 2

models:
  - name: dim_property
    description: |
      Property dimension with SCD Type 2 tracking.
      Captures structural property attributes that change over time.
      Each property can have multiple versions based on renovation or data corrections.
    
    columns:
      - name: property_id
        description: Natural key for property (Zillow property ID)
        tests:
          - not_null

      - name: bedrooms
        description: Number of bedrooms
        tests:
          - not_null

      - name: bathrooms
        description: Number of bathrooms
        tests:
          - not_null

      - name: living_area
        description: Living area in square feet

      - name: lot_area
        description: Lot area in acres

      - name: property_type
        description: Type of property
        tests:
          - accepted_values:
              values: ['SINGLE_FAMILY', 'CONDO', 'TOWNHOUSE', 'MULTI_FAMILY', 'APARTMENT', 'LOT']

      - name: listing_status
        description: Current listing status
        tests:
          - accepted_values:
              values: ['FOR_SALE', 'PENDING', 'SOLD', 'OFF_MARKET', 'FOR_RENT']

      - name: valid_from
        description: Start of validity period (SCD Type 2)
        tests:
          - not_null

      - name: valid_to
        description: End of validity period (NULL = current version)

      - name: is_current
        description: Flag indicating current version
        tests:
          - not_null

    tests:
      # Ensure only one current version per property
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - property_id
            - is_current
          where: "is_current = true"

  - name: dim_location
    description: |
      Geographic dimension for property locations.
      Static dimension - locations don't change once created.
    
    columns:
      - name: location_id
        description: Surrogate key for location
        tests:
          - not_null
          - unique

      - name: street_address
        description: Full street address
        tests:
          - not_null

      - name: city
        description: City name
        tests:
          - not_null

      - name: state
        description: State abbreviation
        tests:
          - not_null

      - name: zip_code
        description: ZIP code

      - name: vegas_district
        description: Las Vegas district classification

      - name: latitude
        description: Latitude coordinate

      - name: longitude
        description: Longitude coordinate

  - name: dim_date
    description: |
      Calendar dimension for time-based analysis.
      Contains one row per snapshot date.
    
    columns:
      - name: date_id
        description: Surrogate key (YYYYMMDD format)
        tests:
          - not_null
          - unique

      - name: date_day
        description: Actual date
        tests:
          - not_null
          - unique

      - name: year
        description: Year
        tests:
          - not_null

      - name: month
        description: Month
        tests:
          - not_null

      - name: day
        description: Day of month
        tests:
          - not_null